//:imagesdir: ../images

[[section-building-block-view]]

== Building Block View

=== Whitebox Overall System

image:whitebox-overall-system.drawio.svg[]

[options="header",cols="1,3"]
|===
|Building Block |Description

| (spa) show-dancer
|Single Page Application, written in Angular, that contains all UIs from all Users (Dancers, Schools,...)

| dancer
|Backend for Frontend (BFF) that connects the show-dancer, with all other components. Contains also cross-sectional modules like user/account-handling.

| recommendation
| Computes all the recommendations (Dancer-Dancer, Dancer-Events, Dancer-Schools). Read Business Events from almost every system to achieve this.

| chat-dancer
| implements the functionality that lets the dancers chat with each other

| kikeriki
| System sending out mails via external SMTP server, depending on the certain business state. Determine the business state by reading Business Events from almost every system.

| school
| Maintains schools. If they have events like course, those will be handled by _events_.

| events
| Handling dance evenings, workshops, courses,..

| SMTP-server
| External server that we use to send mail

|===


=== Blackbox SPA/Show-Dancer

[cols="h,4", stripes=none]
|===
|Purpose
|Provides all our UIs for dancers, schools,... 

|Input-Interface
|Web-Interface to be used with normal Web-Browsers. By using responsive web design methods, we make Dancier accessible to almost any device that runs a web browser.

|Output-Interface
|Connect to the "Dancer" our backend for frontend.

|Risks
|Could become a frontend monolith, as it handles the ui for really everything.

|Repo
|https://github.com/dancier/show-dancer
|===

=== Blackbox Dancer

[cols="h,4", stripes=none]
|===
|Purpose
|Backend for frontend to Dancier. All calls from the internet go through this component. It handles also the User/Account/Profile management. This is the case as we started with a monolithic approach for Dancier, putting everything in one modular monolith. Having the mentioned functionalities included in Dancier, actually makes no problems, so we stick to this.

|Interface
|The Dancer has a link:https://editor.swagger.io/?url=https%3A%2F%2Fraw.githubusercontent.com%2Fdancier%2Fdancer%2Fmaster%2Fswagger.yaml[Rest-API] to let our Angular Single Page Application (SPA) communicate with the whole Dancier System.

See the link:https://project.dancier.net/documentation/arc42/index.html#whitebox_overall_system[whitebox overall system] to infer what services are used by the Dancer directly.

Additionally the Dancer emits Business Events for every interessting use case the dancer is mainly responsible for. This means mostly the handling of accounts and user profiles. The Events are send to an S3 Bucket and to Kafka to be picked up by other services, that need that information.

(The Dancer will forward also every event it receives via the REST Event Endpoing) it receives from the SPA, as it could not connect to Kafka.

|Risks/Smells
|The Dancer is something in between of a pure Backend For Frontend and a little modulith, das it also contains some modules with business logic. This is the case because we initially wanted to have started with a modulith instead of lot's of Microservices. The current setup makes testing a little bit more cumbersome. In case this will be to tedious for us, we have to refactor that.

|Repo
|https://github.com/dancier/dancer
|===

=== Blackbox Recommendation

[cols="h,4", stripes=none]
|===
|Purpose
|Identify all Pairs of dancers that are likely to constitute a good dancing couple.

|Interface

|The Recommendation System reads once a day, all profile updated events. Computes all scores new and offers them via a REST-Endpoint.

|Risks
|Computing Score only once a day could become to bad for our customers and we have to refactor to a degree, that you can call it more of a rewrite.

|Repo
|https://github.com/dancier/recommendation
|===


=== Blackbox Chat-Dancer

[cols="h,4", stripes=none]
|===
|Purpose
|This is the backend for al chat related functionality

|Interface
|Ist being invoked by the dancer via its REST-API to create/maintain chats. Write <<BusinessEvent>> to Kafka in all interesting cases like ChatCreated, and MessageReceived. They are meant to be consumed by other systems eg. to determine if you should write the customer an e-mail to inform him about a new chat message...

|Risks
|Maybe we could have found an open-source chat backend. We decided against it, as we considered the effort to integrate a third-party tool, could be on par with the effort to implement basic functionality. If this would be the case, then we would be more flexible with our solution.
But this was mostly grounded and bare assumptions.

|Repo
|https://github.com/dancier/chat-dancer

|===


=== Blackbox Kikeriki

[cols="h,4", stripes=none]
|===
|Purpose
|Send out mail to Danciers stakeholder

|Interface

a|Read Business Events from all other systems like:

* when a user logs in
* when a user is active
* when a user changes it's profile
* when there are new recommendations for a user
* when a new chat message arrives for a user
* ...

It then determines on certain rules, whether to send an email to the user or not.


|Repo
|https://github.com/dancier/kikeriki
|===
